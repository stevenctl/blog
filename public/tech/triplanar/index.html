<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="light"
  data-auto-appearance="false"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Triplanar with Deep Parallax in Godot &middot; Dirt is Food</title>
  <meta name="title" content="Triplanar with Deep Parallax in Godot &middot; Dirt is Food" />
  
  
  
  
  
  <link rel="canonical" href="https://landow.dev/tech/triplanar/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.c6cb7d76bc2f7ad3b49117792dc4c22ec9879b2a91fa3bc6abe4f5e2072998a2acd74d88c828d3aa4c09c262aec6740a233b56dc9c2f1e35bf9f400581150cc2.css"
    integrity="sha512-xst9drwvetO0kRd5LcTCLsmHmyqR&#43;jvGq&#43;T14gcpmKKs102IyCjTqkwJwmKuxnQKIztW3JwvHjW/n0AFgRUMwg==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Triplanar with Deep Parallax in Godot" />
<meta property="og:description" content="I don&rsquo;t think this is going to be that useful in most games. Triplanar mapping is already expensive, and multiplying that by the samples for paralax occlusion mapping is probably a bad idea.
In my current WFC prototypes, I&rsquo;m re-using models and rotating them. At some point I&rsquo;ll need to handle also transforming the UVs based on the rotation of the tiles&rsquo; models, but for now triplanar can help me with look development." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://landow.dev/tech/triplanar/" /><meta property="og:image" content="https://landow.dev/tech/triplanar/featured.png" /><meta property="article:section" content="tech" />




  <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://landow.dev/tech/triplanar/featured.png" /><meta name="twitter:title" content="Triplanar with Deep Parallax in Godot"/>
<meta name="twitter:description" content="I don&rsquo;t think this is going to be that useful in most games. Triplanar mapping is already expensive, and multiplying that by the samples for paralax occlusion mapping is probably a bad idea.
In my current WFC prototypes, I&rsquo;m re-using models and rotating them. At some point I&rsquo;ll need to handle also transforming the UVs based on the rotation of the tiles&rsquo; models, but for now triplanar can help me with look development."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Techincal Posts",
    "name": "Triplanar with Deep Parallax in Godot",
    "headline": "Triplanar with Deep Parallax in Godot",
    
    "abstract": "I don\u0026rsquo;t think this is going to be that useful in most games. Triplanar mapping is already expensive, and multiplying that by the samples for paralax occlusion mapping is probably a bad idea.\nIn my current WFC prototypes, I\u0026rsquo;m re-using models and rotating them. At some point I\u0026rsquo;ll need to handle also transforming the UVs based on the rotation of the tiles\u0026rsquo; models, but for now triplanar can help me with look development.",
    "inLanguage": "en",
    "url" : "https:\/\/landow.dev\/tech\/triplanar\/",
    "author" : {
      "@type": "Person",
      "name": "Steven Landow"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "970"
  }]
  </script>


  
  
  <meta name="author" content="Steven Landow" />
  
  
  
  <link href="https://github.com/stevenctl" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>


















  
  

  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">Dirt is Food</span>

            <img src="/logo.png" width="250" height="250"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="Dirt is Food" />

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Dirt is Food</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/art/"  class="flex items-center">
    
    <p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Art">
        Art
    </p>
</a>


            
            
  <a href="/tech/"  class="flex items-center">
    
    <p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Techincal Posts">
        Techincal Posts
    </p>
</a>


            
            

            


            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button">
                    <div class="flex items-center justify-center h-12 dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden h-12 dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12">

            <span></span>

            


            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" style="margin-right:5px">
                <div class="flex items-center justify-center h-12 dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden h-12 dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/art/"  class="flex items-center">
        
        <p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Art">
            Art
        </p>
    </a>
</li>



                    

                    
  <li class="mt-1">
    <a href="/tech/"  class="flex items-center">
        
        <p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Techincal Posts">
            Techincal Posts
        </p>
    </a>
</li>



                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>





  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Triplanar with Deep Parallax in Godot
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  

























<div class="flex flex-row flex-wrap items-center">
  
  

  
  
</div>







    </div>

    
    
    
    
    

    

    

    

    
  
  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10">

         <details open class="toc-right mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#heightmap-with-deep-parallax">Heightmap with Deep Parallax</a></li>
    <li><a href="#normal-map-only">Normal Map Only</a></li>
    <li><a href="#the-shader">The Shader</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#heightmap-with-deep-parallax">Heightmap with Deep Parallax</a></li>
    <li><a href="#normal-map-only">Normal Map Only</a></li>
    <li><a href="#the-shader">The Shader</a></li>
  </ul>
</nav>
  </div>
</details>

   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          <p>I don&rsquo;t think this is going to be that useful in most games. Triplanar mapping
is already expensive, and multiplying that by the samples for paralax occlusion
mapping is probably a bad idea.</p>
<p>In my current WFC prototypes, I&rsquo;m re-using models and rotating them. At some
point I&rsquo;ll need to handle also transforming the UVs based on the rotation of
the tiles&rsquo; models, but for now triplanar can help me with look development.</p>
<p>I want to use heightmaps to add details without extra geometry. While modern
game engines and hardware can handle an insane number of triangles, my workflow
for creating models that tile perfectly cannot.</p>
<p>The effect is turned up a bit to make it extra apparent int he sample. The floor
shouldn&rsquo;t be offset so strongly if you want to have a character walk on it.</p>
<h2 class="relative group">Heightmap with Deep Parallax 
    <div id="heightmap-with-deep-parallax" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#heightmap-with-deep-parallax" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<video src="pom.webm" autoplay muted loop></video>

<p>There is a ton of detail in the floor and walls. Some bricks/stones occlude
others. It&rsquo;s really awesome.</p>
<h2 class="relative group">Normal Map Only 
    <div id="normal-map-only" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#normal-map-only" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<video src="norm.webm" autoplay muted loop></video>

<p>If performance does become and issue, using the normal map textures seems to be
good enough. This is using the simplest &ldquo;swizzle&rdquo; approach from Ben Golus&rsquo;s
<a href="https://bgolus.medium.com/normal-mapping-for-a-triplanar-shader-10bf39dca05a"   target="_blank">
    Normal Mapping for a Triplanar
Shader</a>
tutorial, and I think the results are just fine.</p>
<p>Without this fix, you get very wrong normals. It&rsquo;s subtle in this sample scene
but areas in negative directions start looking dark in a confusing way.</p>
<h2 class="relative group">The Shader 
    <div id="the-shader" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#the-shader" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Here&rsquo;s the code for those who are interested. It&rsquo;s mostly me gluing code from
various tutorials together. Also there&rsquo;s some unnessary conditionals I have for
toggling the ability to use two sets of textures for the walls and floor. In
reality there should be a separate shader for each, or some preprocessor stuff
instead of a runtime check.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>shader_type spatial;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> blendSharpness;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uniform sampler2D textureMap : source_color;
</span></span><span style="display:flex;"><span>uniform sampler2D normalMap : hint_normal;
</span></span><span style="display:flex;"><span>uniform sampler2D heightMap : hint_default_white;
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> normalMapStrength : <span style="color:#a6e22e">hint_range</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>;
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> uvScale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">bool</span> enableFloor <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>uniform sampler2D floorTextureMap : source_color;
</span></span><span style="display:flex;"><span>uniform sampler2D floorNormalMap : hint_normal;
</span></span><span style="display:flex;"><span>uniform sampler2D floorHeightMap : hint_default_white;
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> floorUvScale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">bool</span> enablePom <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">int</span> heightMinLayers <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">int</span> heightMaxLayers <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>;
</span></span><span style="display:flex;"><span>uniform <span style="color:#66d9ef">float</span> heightScale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>varying vec3 worldPos;
</span></span><span style="display:flex;"><span>varying vec3 worldNormal;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">vertex</span>() {
</span></span><span style="display:flex;"><span>	 <span style="color:#75715e">// Transform the vertex position to world space
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    worldPos <span style="color:#f92672">=</span> (MODEL_MATRIX <span style="color:#f92672">*</span> <span style="color:#a6e22e">vec4</span>(VERTEX, <span style="color:#ae81ff">1.0</span>)).xyz;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Transform the vertex normal to world space
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    worldNormal <span style="color:#f92672">=</span> <span style="color:#a6e22e">normalize</span>((MODEL_MATRIX <span style="color:#f92672">*</span> <span style="color:#a6e22e">vec4</span>(NORMAL, <span style="color:#ae81ff">0.0</span>)).xyz);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// TODO conditionals...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vec2 <span style="color:#a6e22e">scaleUV</span>(<span style="color:#66d9ef">float</span> yDot, vec2 uv) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> uv <span style="color:#f92672">*</span> (enableFloor <span style="color:#f92672">&amp;&amp;</span> yDot <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span> <span style="color:#f92672">?</span> floorUvScale : uvScale);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// TODO conditionals...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vec4 <span style="color:#a6e22e">sampleColor</span>(<span style="color:#66d9ef">float</span> yDot, vec2 uv) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> enableFloor <span style="color:#f92672">&amp;&amp;</span> yDot <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">texture</span>(floorTextureMap, uv) <span style="color:#f92672">:</span> <span style="color:#a6e22e">texture</span>(textureMap, uv);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// TODO conditionals...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vec4 <span style="color:#a6e22e">sampleHeight</span>(<span style="color:#66d9ef">float</span> yDot, vec2 uv) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> enableFloor <span style="color:#f92672">&amp;&amp;</span> yDot <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">texture</span>(floorHeightMap, uv) <span style="color:#f92672">:</span> <span style="color:#a6e22e">texture</span>(heightMap, uv);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// TODO conditionals...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vec4 <span style="color:#a6e22e">sampleNormal</span>(<span style="color:#66d9ef">float</span> yDot, vec2 uv) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> enableFloor <span style="color:#f92672">&amp;&amp;</span> yDot <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">texture</span>(floorNormalMap, uv) <span style="color:#f92672">:</span> <span style="color:#a6e22e">texture</span>(normalMap, uv);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vec4 <span style="color:#a6e22e">triplanarSample</span>(vec2 uvX, vec2 uvY, vec2 uvZ, vec3 blend, <span style="color:#66d9ef">float</span> yDot) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Sample the texture using the calculated texture coordinates
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vec4 texColorX <span style="color:#f92672">=</span> <span style="color:#a6e22e">texture</span>(textureMap, uvX);
</span></span><span style="display:flex;"><span>    vec4 texColorY <span style="color:#f92672">=</span> <span style="color:#a6e22e">sampleColor</span>(yDot, uvY);
</span></span><span style="display:flex;"><span>    vec4 texColorZ <span style="color:#f92672">=</span> <span style="color:#a6e22e">texture</span>(textureMap, uvZ);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Blend the samples together
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> texColorX <span style="color:#f92672">*</span> blend.x
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> texColorY <span style="color:#f92672">*</span> blend.y
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> texColorZ <span style="color:#f92672">*</span> blend.z;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The simplest appoach suggested in the goat&#39;s article:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// https://bgolus.medium.com/normal-mapping-for-a-triplanar-shader-10bf39dca05a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vec3 <span style="color:#a6e22e">triplanarNormal</span>(<span style="color:#66d9ef">float</span> yDot, vec2 uvX, vec2 uvY, vec2 uvZ, vec3 blend) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Tangent space normal maps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vec3 tnormalX <span style="color:#f92672">=</span> <span style="color:#a6e22e">texture</span>(normalMap, uvX).rgb;
</span></span><span style="display:flex;"><span>    vec3 tnormalY <span style="color:#f92672">=</span> <span style="color:#a6e22e">sampleNormal</span>(yDot, uvY).rgb;
</span></span><span style="display:flex;"><span>    vec3 tnormalZ <span style="color:#f92672">=</span> <span style="color:#a6e22e">texture</span>(normalMap, uvZ).rgb;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Get the sign (-1 or 1) of the surface normal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vec3 axisSign <span style="color:#f92672">=</span> <span style="color:#a6e22e">sign</span>(worldNormal);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Flip tangent normal z to account for surface normal facing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    tnormalX.z <span style="color:#f92672">*=</span> axisSign.x;
</span></span><span style="display:flex;"><span>    tnormalY.z <span style="color:#f92672">*=</span> axisSign.y;
</span></span><span style="display:flex;"><span>    tnormalZ.z <span style="color:#f92672">*=</span> axisSign.z;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Swizzle tangent normals to match world orientation and triblend
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">normalize</span>(
</span></span><span style="display:flex;"><span>      tnormalX.zyx <span style="color:#f92672">*</span> blend.x <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      tnormalY.xzy <span style="color:#f92672">*</span> blend.y <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>      tnormalZ.xyz <span style="color:#f92672">*</span> blend.z
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Adapted from the tutorial. Changed to accept a viewDir which represents each plane.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// https://www.youtube.com/watch?v=LrnE5f3h2SU
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>vec2 <span style="color:#a6e22e">pomUV</span>(<span style="color:#66d9ef">float</span> yDot, vec2 m_base_uv, vec3 viewDir) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> viewDot <span style="color:#f92672">=</span> <span style="color:#a6e22e">dot</span>(viewDir, <span style="color:#a6e22e">vec3</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> minLayers <span style="color:#f92672">=</span> <span style="color:#66d9ef">float</span>(<span style="color:#a6e22e">min</span>(heightMinLayers, heightMaxLayers));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> maxLayers <span style="color:#f92672">=</span> <span style="color:#66d9ef">float</span>(<span style="color:#a6e22e">max</span>(heightMinLayers, heightMaxLayers));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> numLayers <span style="color:#f92672">=</span> <span style="color:#a6e22e">mix</span>(maxLayers, minLayers, <span style="color:#a6e22e">abs</span>(viewDot));
</span></span><span style="display:flex;"><span>    numLayers <span style="color:#f92672">=</span> <span style="color:#a6e22e">clamp</span>(numLayers, minLayers, maxLayers);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> layerDepth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0f</span> <span style="color:#f92672">/</span> numLayers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    vec2 uvOffset <span style="color:#f92672">=</span> viewDir.xy <span style="color:#f92672">*</span> heightScale <span style="color:#f92672">/</span> numLayers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// tracks how &#34;deep&#34; we are on each iteration
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">float</span> currentLayerDepth <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// tracks how deep the heightmap; adjusted on each iteration as UVs shift
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">float</span> depthMapValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">sampleHeight</span>(yDot, m_base_uv).r;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// loop until the current layer is deeper than the heightmap (hit)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// the 100 iteration cap is because I&#39;m paranoid
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">&amp;&amp;</span> currentLayerDepth <span style="color:#f92672">&lt;</span> depthMapValue; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        m_base_uv <span style="color:#f92672">-=</span> uvOffset;
</span></span><span style="display:flex;"><span>        depthMapValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">sampleHeight</span>(yDot, m_base_uv).r;
</span></span><span style="display:flex;"><span>        currentLayerDepth <span style="color:#f92672">+=</span> layerDepth;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// occlusion (interpolate with prev value)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vec2 prevUV <span style="color:#f92672">=</span> m_base_uv <span style="color:#f92672">+</span> uvOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> afterDepth <span style="color:#f92672">=</span>  depthMapValue <span style="color:#f92672">-</span> currentLayerDepth;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> beforeDepth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">sampleHeight</span>(yDot, prevUV).r <span style="color:#f92672">-</span> currentLayerDepth <span style="color:#f92672">+</span> layerDepth;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> weight <span style="color:#f92672">=</span> afterDepth <span style="color:#f92672">/</span> (afterDepth <span style="color:#f92672">-</span> beforeDepth);
</span></span><span style="display:flex;"><span>    m_base_uv <span style="color:#f92672">=</span> prevUV <span style="color:#f92672">*</span> weight <span style="color:#f92672">+</span> m_base_uv <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> weight);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> m_base_uv;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">fragment</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Calculate blending
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">float</span> yDot <span style="color:#f92672">=</span> <span style="color:#a6e22e">dot</span>(worldNormal, <span style="color:#a6e22e">vec3</span>(<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.0</span>));
</span></span><span style="display:flex;"><span>    vec3 blend <span style="color:#f92672">=</span> <span style="color:#a6e22e">vec3</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">smoothstep</span>(blendSharpness, <span style="color:#ae81ff">1.0</span>, <span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">dot</span>(worldNormal, <span style="color:#a6e22e">vec3</span>(<span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>)))),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">smoothstep</span>(blendSharpness, <span style="color:#ae81ff">1.0</span>, <span style="color:#a6e22e">abs</span>(yDot)),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">smoothstep</span>(blendSharpness, <span style="color:#ae81ff">1.0</span>, <span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">dot</span>(worldNormal, <span style="color:#a6e22e">vec3</span>(<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>))))
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// view dir will be swizzled to match coordinates
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vec3 viewDir <span style="color:#f92672">=</span> <span style="color:#a6e22e">normalize</span>(CAMERA_POSITION_WORLD <span style="color:#f92672">-</span> worldPos);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Calculate texture coordinates
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    vec2 texCoordX <span style="color:#f92672">=</span> worldPos.zy <span style="color:#f92672">*</span> uvScale;
</span></span><span style="display:flex;"><span>    vec2 texCoordY <span style="color:#f92672">=</span> <span style="color:#a6e22e">scaleUV</span>(yDot, worldPos.zx);
</span></span><span style="display:flex;"><span>    vec2 texCoordZ <span style="color:#f92672">=</span> worldPos.xy <span style="color:#f92672">*</span> uvScale;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO conditionals...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (enablePom) {
</span></span><span style="display:flex;"><span>      texCoordX <span style="color:#f92672">=</span> <span style="color:#a6e22e">pomUV</span>(yDot, texCoordX, viewDir.zyx);
</span></span><span style="display:flex;"><span>      texCoordY <span style="color:#f92672">=</span> <span style="color:#a6e22e">pomUV</span>(yDot, texCoordY, viewDir.zxy);
</span></span><span style="display:flex;"><span>      texCoordZ <span style="color:#f92672">=</span> <span style="color:#a6e22e">pomUV</span>(yDot, texCoordZ, viewDir.xyz);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// sample and output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ALBEDO <span style="color:#f92672">=</span> <span style="color:#a6e22e">triplanarSample</span>(texCoordX, texCoordY, texCoordZ, blend, yDot).rgb;
</span></span><span style="display:flex;"><span>    NORMAL <span style="color:#f92672">=</span> <span style="color:#a6e22e">mix</span>(worldNormal, <span style="color:#a6e22e">triplanarNormal</span>(yDot, texCoordX, texCoordY, texCoordZ, blend), normalMapStrength);
</span></span><span style="display:flex;"><span>    NORMAL <span style="color:#f92672">=</span> <span style="color:#a6e22e">normalize</span>((VIEW_MATRIX <span style="color:#f92672">*</span> <span style="color:#a6e22e">vec4</span>(NORMAL, <span style="color:#ae81ff">0.0</span>)).xyz);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
        </div>
                
        

        

          
      </div>
     
    
     <script>
        var oid = "views_tech\/triplanar\/index.md"
        var oid_likes = "likes_tech\/triplanar\/index.md"
      </script>
      
      
      
      <script type="text/javascript" src="/js/page.min.5b1bad196a6075a1e11bae1dc95f24f67b610948a00525e347566c5a62338ea78f1c7224ab9a53873dcdb2a1a7d7d391b8a8ef45561297f68806c01315b0c4f6.js" integrity="sha512-WxutGWpgdaHhG64dyV8k9nthCUigBSXjR1ZsWmIzjqePHHIkq5pThz3NsqGn19ORuKjvRVYSl/aIBsATFbDE9g=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/tech/buoyancy/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Faking Buoyancy</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      Steven Landow
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js" integrity="sha512-YgYLskf03itt3kWQNmj&#43;&#43;2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script>
  
  
</footer>
  </div>
</body>

</html>
